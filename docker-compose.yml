version: '3'
services:
	app:
		build:
			context: .
			dockerfile: Dockerfile
			image: digitalocean.com/php
			container_name: api_sipmen
			restart: unless-stopped
			tty: true
			environment:
				SERVICE_NAME: api.sipmen
				SERVICE_TAG: dev
			working_dir: /var/www
			volumes:
				- ./:/var/www
				- ./php/local.ini:/usr/local/etc/php/conf.d/local.ini
			networks:
				- api.sipmen-network
	
	webserver:
		image: nginx:alpine
		container_name: webserver
		restart: unless-stopped
		tty: true
		ports:
			- "80:80"
			- "443:443"
		networks:
			- api.sipmen-network
		volumes:
			- ./:var/www
			- ./nginx/conf.d/:/etc/nginx/conf.d/

	db:
		image: mysql:5.7.22
		container_name: db
		restart: unless-stopped
		tty: true
		ports:
			- "3306:3306"
		environment:
			MYSQL_DATABASE:	db_sipmen
			MYSQL_ROOT_PASSWORD: kerakbumijadisatu
			SERVICE_TAGS: dev
			SERVICE_NAME: mysql
		volumes:
			- dbdata:/var/lib/mysql
			- ./mysql/my.cnf:/etc/mysql/my.cnf
		networks:
			- api.sipmen-network


networks:
	api.sipmen-network:
		driver: bridge
volumes:
	dbdata:
		driver: local
